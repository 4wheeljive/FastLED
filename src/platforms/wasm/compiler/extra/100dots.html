<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>LED Grid Demo</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
            margin: 0 auto;
            background-color: black;
        }
    </style>
</head>

<body>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.module.min.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>
    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        
        class LedGrid {
            constructor(width, height) {
                this.SCREEN_WIDTH = width;
                this.SCREEN_HEIGHT = height;
                this.SEGMENTS = 16;
                this.LED_SCALE = 1.0;
                this.leds = [];
                
                this.initScene();
                this.createGrid();

            }

            initScene() {
                this.scene = new THREE.Scene();
                this.camera = new THREE.OrthographicCamera(
                    -this.SCREEN_WIDTH/2, this.SCREEN_WIDTH/2, 
                    this.SCREEN_HEIGHT/2, -this.SCREEN_HEIGHT/2, 
                    1, 1000
                );
                this.camera.position.z = 500;

                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(this.SCREEN_WIDTH, this.SCREEN_HEIGHT);
                document.body.appendChild(this.renderer.domElement);

                const renderScene = new RenderPass(this.scene, this.camera);
                const bloomPass = new UnrealBloomPass(
                    new THREE.Vector2(this.SCREEN_WIDTH, this.SCREEN_HEIGHT),
                    16.0,
                    1.0,
                    0.0
                );

                this.composer = new EffectComposer(this.renderer);
                this.composer.addPass(renderScene);
                this.composer.addPass(bloomPass);
            }

            createGrid() {
                const gridSizeX = 100;
                const gridSizeY = gridSizeX * (this.SCREEN_HEIGHT / this.SCREEN_WIDTH);
                
                const containerWidth = this.SCREEN_WIDTH;
                const containerHeight = this.SCREEN_HEIGHT;
                
                const spacingX = containerWidth / gridSizeX;
                const spacingY = containerHeight / gridSizeY;
                
                const dotSize = Math.min(spacingX, spacingY) * 0.4;
                
                const offsetX = -containerWidth / 2 + spacingX / 2;
                const offsetY = -containerHeight / 2 + spacingY / 2;

                for (let x = 0; x < gridSizeX; x++) {
                    for (let y = 0; y < gridSizeY; y++) {
                        const geometry = new THREE.CircleGeometry(dotSize * this.LED_SCALE, this.SEGMENTS);
                        const material = new THREE.MeshBasicMaterial({ color: 0x000000 });
                        const led = new THREE.Mesh(geometry, material);
                        led.position.set(
                            offsetX + x * spacingX,
                            offsetY + y * spacingY,
                            0
                        );
                        this.scene.add(led);
                        this.leds.push(led);
                    }
                }
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                this.leds.forEach(led => {
                    led.material.color.multiplyScalar(0.85);
                    if (Math.random() < 0.01) {
                        led.material.color.setRGB(Math.random(), Math.random(), Math.random());
                    }
                });

                this.composer.render();
            }
        }

        // Constants for screen dimensions
        const SCREEN_WIDTH = 800;
        const SCREEN_HEIGHT = SCREEN_WIDTH / 2;


        const ledGrid = new LedGrid(SCREEN_WIDTH, SCREEN_HEIGHT);
        ledGrid.animate();
    </script>
</body>

</html>
